# 与单元测试/集成测试的区别

在自动化测试领域，经常会通过一张金字塔图说明单元测试、集成测试与 UI 测试三者之间的关系。图中位置越靠下的测试执行速度越快、维护成本越低、测试粒度越细，因此一个理想的测试用例比例应该是单元测试占到绝大部分，再搭配部分集成测试与一些 UI 测试。

那么是否应该严格遵循这一理论，在项目中单元测试覆盖率不足的情况下不需要考虑 UI 测试呢？事实上图中的金字塔表明的应该是一个成熟、稳定、自动化测试覆盖极其完善的项目的测试用例状态，如果读者所开发维护的项目仍处于测试覆盖率不高、大量依赖人工手动测试且bug数量不低的阶段，**则更应该思考怎么样渐进式的补充对现阶段项目质量最起效果的测试用例**，优先减少bug数量，再不断补充各类测试用例最终达到一个合理的比例。换句话说，在这种情况下开发者给项目添加测试用例的幸福感才是最重要的。

之所以提到“幸福感”这个概念，是因为自动化测试和学生时代答完考卷还得再检查一两遍一样，是一种与人们追求自由、创造的天性相违背的过程。但为了提高工程质量，又是必不可少的环节，所以要减少工程师们编写测试的抵触感，就要让测试有效的发现 bug，从而令工程师获得成就感进而心态上进入一个积极的循环。

言归正传，UI 测试与单元测试、集成测试最大的区别在于对工程的覆盖路径以及覆盖效率不同。

以下图为例：

可以将绿色的主干理解为产品最基本的使用逻辑或是代码最主线的执行方式，分叉则是根据条件判断产生的衍生逻辑，例如错误处理、异常恢复、定制场景等等。

理论上我们可以对每个分叉的每一小段都覆盖单元测试，保证该段逻辑单独执行时没有问题，但是在段与段交互的过程中依然有可能出现问题。为了覆盖这类不同单元间的交互问题，我们通常会把多个相关联的单元放在一起连贯测试，这就是所谓的集成测试。但集成与集成之间仍然会有测试未覆盖的交互间隙，因此最彻底的覆盖就是进行端到端的测试，UI 测试就是端到端测试的主要实践方式。

但是覆盖越彻底也意味着重复的覆盖越多，例如要对图中所有路径进行端到端的覆盖（可以理解为从图中底部开始走到所有可以到达的顶部），那么会重复多次走过相同的主干，在实际场景中就会让测试变的冗余且低效。所以为了保证效率，我们应该用最稳固的方式覆盖容错性最低的路径，也就是对主干逻辑覆盖端到端测试，再用集成测试和单元测试保证分叉中逻辑的覆盖。

